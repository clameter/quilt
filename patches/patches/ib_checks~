Index: rdma-core/ib2roce/ib2roce.c
===================================================================
--- rdma-core.orig/ib2roce/ib2roce.c
+++ rdma-core/ib2roce/ib2roce.c
@@ -1428,6 +1428,11 @@ static struct rdma_channel *create_packe
 		.sll_halen = sizeof(struct in_addr),
 	};
 
+	if (i == i2r + INFINIBAND) {
+		logg(LOG_ERR, "Packet Sockets do not work right on Infiniband");
+		return NULL;
+	}
+
 	fh = socket(AF_PACKET, SOCK_RAW, htons(ETH_P_ALL));
 
 	if (fh < 0) {
@@ -2366,8 +2371,7 @@ static struct endpoint *at_to_ep(struct
 		at->is_global = 1;
 		map_ipv4_addr_to_ipv6(addr.s_addr, (struct in6_addr *)&at->grh.dgid);
 
-	} else
-	if (addr.s_addr) {	/* INFINIBAND is a bit more involved and some calls here may take a long time*/
+	} else if (addr.s_addr) {	/* INFINIBAND is a bit more involved and some calls here may take a long time*/
 
 		struct rdma_cm_id *id;
 		struct sockaddr_in sin = {
@@ -2501,7 +2505,17 @@ static struct endpoint *buf_to_ep(struct
 		if (!addr.s_addr)
 			addr.s_addr = buf->ip.saddr;
 
-	} else {	/* Infiniband */
+	} else
+        if (i == i2r + INFINIBAND) {	/* Infiniband */
+
+		if (!unicast_lid(w->slid)) {
+
+			/* No source LID */
+			logg(LOG_ERR, "Invalid Source LID %x on %s\n", w->slid, c->text);
+			free(ep);
+
+			return NULL;
+		}
 		if (buf->grh_valid) {
 			void *position = buf->cur;
 
@@ -2521,14 +2535,6 @@ static struct endpoint *buf_to_ep(struct
 			}
 			buf->cur = position;
 		}
-		if (!unicast_lid(w->slid)) {
-
-			/* No source LID */
-			logg(LOG_ERR, "Invalid Source LID %x\n", w->slid);
-			free(ep);
-
-			return NULL;
-		}
 	}
 
 	buf->addr.s_addr = 0;
