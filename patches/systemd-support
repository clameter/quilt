Index: rdma-core/ib2roce/CMakeLists.txt-NO_MSTFLINT
===================================================================
--- rdma-core.orig/ib2roce/CMakeLists.txt-NO_MSTFLINT
+++ rdma-core/ib2roce/CMakeLists.txt-NO_MSTFLINT
@@ -41,3 +41,10 @@ rdma_man_pages(
   man/ib2roce.1
   man/ib2roce.7
   )
+
+rdma_subst_install(FILES "ib2roce.service.in"
+  DESTINATION "${CMAKE_INSTALL_SYSTEMD_SERVICEDIR}"
+  RENAME ib2roce.service
+  PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)
+
+
Index: rdma-core/ib2roce/ib2roce.c
===================================================================
--- rdma-core.orig/ib2roce/ib2roce.c
+++ rdma-core/ib2roce/ib2roce.c
@@ -45,30 +45,13 @@
 #include <signal.h>
 #include <sys/types.h>
 #include <sys/stat.h>
-#include <syslog.h>
 #include <fcntl.h>
 #include <ctype.h>
-#include <pthread.h>
-#include <stdatomic.h>
 #include <arpa/inet.h>
 #include <sys/socket.h>
-#include <netdb.h>
-#include <getopt.h>
-#include <rdma/rdma_cma.h>
-#include <poll.h>
-#include <sys/mman.h>
 #include <numa.h>
-#include <infiniband/mad.h>
-#include <linux/if_arp.h>
+#include <systemd/sd-daemon.h>
 
-
-#include <linux/rtnetlink.h>
-#include <net/ethernet.h>
-#include <linux/ip.h>
-#include <linux/udp.h>
-#include <infiniband/umad_cm.h>
-#include <infiniband/umad_str.h>
-#include <execinfo.h>
 #include "errno.h"
 #include "fifo.h"
 #include "ring.h"
@@ -85,7 +68,6 @@
 #include "endpoint.h"
 #include "unicast.h"
 #include "ibraw.h"
-#include "cma-hdr.h"
 
 /* Globals */
 
@@ -539,7 +521,6 @@ static void options_init(void)
 	setup_enable();
 }
 
-
 int main(int argc, char **argv)
 {
 	int ret = 0;
@@ -552,8 +533,10 @@ int main(int argc, char **argv)
 
 	} else {
 		background = true;
-		daemonize();
-		pid_open();
+		if (!systemd) {
+			daemonize();
+			pid_open();
+		}
 	}
 	concom_init();
 
@@ -597,9 +580,15 @@ int main(int argc, char **argv)
 	arm_channels(NULL);
 	setup_timed_events();
 
-	if (event_loop() <0)
+	if (systemd)
+		sd_notify(0, "READY=1");
+
+	if (event_loop() < 0)
 		logg(LOG_ERR, "Event Loop failed with %s\n", errname());
 
+	if (systemd)
+		sd_notify(0, "STOPPING=1");
+
 	beacon_shutdown();
 	stop_cores();
 
Index: rdma-core/ib2roce/ib2roce.service.in
===================================================================
--- /dev/null
+++ rdma-core/ib2roce/ib2roce.service.in
@@ -0,0 +1,24 @@
+[Unit]
+Description=Infiniband to ROCE Bridge
+Documentation=man:ib2roce
+# Ensure required kernel modules are loaded before starting
+Wants=rdma-load-modules@rdma.service
+After=rdma-load-modules@rdma.service
+# Order ibacm startup after basic RDMA hw setup.
+After=rdma-hw.target
+
+# Implicitly after basic.target, note that ib2roce writes to /var/log directly
+# and thus needs writable filesystems setup.
+
+[Service]
+Type=notify
+ExecStart=@CMAKE_INSTALL_FULL_SBINDIR@/ibacm --systemd
+ProtectSystem=full
+ProtectHome=true
+ProtectHostname=true
+ProtectKernelLogs=true
+
+[Install]
+# Only want ib2roce if RDMA hardware is present (or the socket is touched)
+WantedBy=rdma-hw.target
+
Index: rdma-core/ib2roce/logging.c
===================================================================
--- rdma-core.orig/ib2roce/logging.c
+++ rdma-core/ib2roce/logging.c
@@ -47,6 +47,7 @@
 #include <sys/stat.h>
 #include <syslog.h>
 #include <execinfo.h>
+#include <systemd/sd-journal.h>
 
 #include "sched.h"
 #include "ring.h"
@@ -58,6 +59,7 @@
 
 int loglevel = LOG_INFO;
 bool background;
+bool systemd;
 
 static void __logg(int prio, const char *fmt, va_list valist)
 {
@@ -69,9 +71,13 @@ static void __logg(int prio, const char
 		n = vsnprintf(b + 1, 149, fmt, valist);
 		ring_put(&current->ring, b, n);
 
-	} else if (background)
-		vsyslog(prio, fmt, valist);
-	else
+	} else if (background) {
+		if (systemd) {
+			sd_journal_printv(prio, fmt, valist);
+		} else
+			vsyslog(prio, fmt, valist);
+
+	} else
 		vprintf(fmt, valist);
 }
 
@@ -301,6 +307,11 @@ static void statuscmd(FILE *out, char *p
 	brief_status(out);
 }
 
+static void systemd_set(char *optarg)
+{
+	systemd = true;
+}
+
 __attribute__((constructor))
 static void logging_init(void)
 {
@@ -309,6 +320,6 @@ static void logging_init(void)
 	register_enable("loglevel", true, NULL, &loglevel, "5","3", NULL,
 		"Log output to console (0=EMERG, 1=ALERT, 2=CRIT, 3=ERR, 4=WARN, 5=NOTICE, 6=INFO, 7=DEBUG)");
 	register_option("verbose", no_argument, 'v', verbose_set, NULL, "Increase logging detail");
+	register_option("systemd", no_argument, 's', systemd_set, NULL, "Operate from systemd");
 }
 
-
Index: rdma-core/ib2roce/logging.h
===================================================================
--- rdma-core.orig/ib2roce/logging.h
+++ rdma-core/ib2roce/logging.h
@@ -51,6 +51,7 @@ __attribute__ ((format (printf, 1, 2)))
 void panic(const char *fmt, ...);
 
 extern bool background;
+extern bool systemd;
 
 char *__hexbytes(char *b, uint8_t *q, unsigned len, char separator);
 
Index: rdma-core/redhat/rdma-core.spec
===================================================================
--- rdma-core.orig/redhat/rdma-core.spec
+++ rdma-core/redhat/rdma-core.spec
@@ -216,6 +216,18 @@ user applications need not know about th
 uses librdmacm to handle connection bring up/tear down.  The librdmacm
 library knows how to talk directly to the ibacm daemon to retrieve data.
 
+%package -n ib2roce
+Summary: InfiniBand to ROCE bridging tool
+Requires(post): systemd-units
+Requires(preun): systemd-units
+Requires(postun): systemd-units
+
+%description -n ib2roce
+The ib2roce daemon bridges between an infiniband interface and
+a roce interface providing the ability to share traffic between
+both types of RDMA architectures. The primary focus is on multicast
+support.
+
 %package -n iwpmd
 Summary: iWarp Port Mapper userspace daemon
 Requires(post): systemd-units
@@ -372,6 +384,13 @@ fi
 %postun -n ibacm
 %systemd_postun_with_restart ibacm.service
 
+%post -n ib2roce
+%systemd_post ib2roce.service
+%preun -n ib2roce
+%systemd_preun ib2roce.service
+%postun -n ib2roce
+%systemd_postun_with_restart ib2roce.service
+
 %post -n srp_daemon
 %systemd_post srp_daemon.service
 %preun -n srp_daemon
@@ -589,6 +608,15 @@ fi
 %{_libdir}/ibacm/*
 %doc %{_docdir}/%{name}/ibacm.md
 
+%files -n ib2roce
+%{_sbindir}/ib2roce
+%{_mandir}/man1/ib2roce.*
+%{_mandir}/man7/ib2roce.*
+%{_unitdir}/ib2roce.service
+%dir %{_libdir}/ib2roce
+%{_libdir}/ib2roce/*
+%doc %{_docdir}/%{name}/ib2roce.md
+
 %files -n iwpmd
 %{_sbindir}/iwpmd
 %{_unitdir}/iwpmd.service
