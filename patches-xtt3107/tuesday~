Index: rdma-core/ib2roce/cma-hdr.h
===================================================================
--- rdma-core.orig/ib2roce/cma-hdr.h
+++ rdma-core/ib2roce/cma-hdr.h
@@ -10,7 +10,8 @@ union cma_ip_addr {
 	struct in6_addr ip6;
 	struct {
 		__be32 qpn;
-		__be32 pad[2];
+		__be32 qkey;
+		__be32 pad[1];
 		__be32 addr;
 	} ip4;
 };
Index: rdma-core/ib2roce/ib2roce.c
===================================================================
--- rdma-core.orig/ib2roce/ib2roce.c
+++ rdma-core/ib2roce/ib2roce.c
@@ -1953,8 +1953,7 @@ static void setup_interface(enum interfa
 	if (i->iges <= 0) {
 		logg(LOG_CRIT, "Error %s. Failed to obtain GID table for %s\n",
 			errname(), i->text);
-		i->context = NULL;
-		return;
+		abort();
 	}
 
 	/* Find the correct gid entry */
@@ -1972,10 +1971,9 @@ static void setup_interface(enum interfa
 	}
 
 	if (e >= i->ige + i->iges) {
-		logg(LOG_CRIT, "Failed to find a suitable entry GID table for %s\n",
+		logg(LOG_CRIT, "Failed to find GIDs in GID table for %s\n",
 			i->text);
-		i->context = NULL;
-		return;
+		abort();
 	}
 
 	/* Copy our connection info from GID table */
@@ -2946,7 +2944,7 @@ redo:
 	ah = ibv_create_ah(i->pd, at);
 	if (!ah) {
 		logg(LOG_ERR, "at_to_ep: Failed to create Endpoint on %s: %s. IP=%s\n",
-				i->text, errname(), inet_ntoa(ep->addr));
+				i->text, errname(), inet_ntoa(addr));
 		return NULL;
 	}
 
@@ -3456,7 +3454,10 @@ static const char *sidr_req(struct buf *
 	}
 
 	ss->source = buf->source_ep;
-	ss->source_qp = ch->src_addr.ip4.qpn;
+	ss->source_qp = ntohl(ch->src_addr.ip4.qpn);
+	logg(LOG_NOTICE, "SDIR_REQ CMA info = SRC QP=%x QKEY=%d DST QP=%x QKEY=%x\n",
+		ntohl(ch->src_addr.ip4.qpn), ntohl(ch->src_addr.ip4.qkey),
+		ntohl(ch->dst_addr.ip4.qpn), ntohl(ch->dst_addr.ip4.qkey));
 	ss->request_id = sr->request_id;
 
 no_cma:
@@ -5149,7 +5150,7 @@ int main(int argc, char **argv)
 	if (ret && !testing)
 		return ret;
 
-	logg (LOG_NOTICE, "%s device = %s:%d, %s device = %s:%d. Multicast Groups=%d MGIDs=%s Buffers=%u\n",
+	syslog (LOG_NOTICE, "%s device = %s:%d, %s device = %s:%d. Multicast Groups=%d MGIDs=%s Buffers=%u\n",
 			interfaces_text[INFINIBAND], i2r[INFINIBAND].rdma_name, i2r[INFINIBAND].port,
 			interfaces_text[ROCE], i2r[ROCE].rdma_name, i2r[ROCE].port,
 			nr_mc, mgid_mode->id, nr_buffers);
@@ -5159,11 +5160,6 @@ int main(int argc, char **argv)
 	setup_interface(INFINIBAND);
 	setup_interface(ROCE);
 
-	if (!i2r[INFINIBAND].context && !i2r[ROCE].context) {
-		logg(LOG_CRIT, "No working RDMA devices present.\n");
-		exit(2);
-	}
-
 	if (cores)
 		show_core_config();
 
