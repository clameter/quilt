Index: rdma-core/ib2roce/CMakeLists.txt-NO_MSTFLINT
===================================================================
--- rdma-core.orig/ib2roce/CMakeLists.txt-NO_MSTFLINT
+++ rdma-core/ib2roce/CMakeLists.txt-NO_MSTFLINT
@@ -8,6 +8,7 @@ rdma_executable(ib2roce
   errno.c
   ring.c
   sched.c
+  logging.c
 )
 target_link_libraries(ib2roce LINK_PRIVATE
   ibverbs
Index: rdma-core/ib2roce/logging.c
===================================================================
--- /dev/null
+++ rdma-core/ib2roce/logging.c
@@ -0,0 +1,105 @@
+/*
+ * Logging support to syslog or console
+ *
+ * (C) 2021-2022 Christoph Lameter <cl@linux.com>
+ *
+ * This software is available to you under a choice of one of two
+ * licenses.  You may choose to be licensed under the terms of the GNU
+ * General Public License (GPL) Version 2, available from the file
+ * COPYING in the main directory of this source tree, or the
+ * OpenIB.org BSD license below:
+ *
+ *     Redistribution and use in source and binary forms, with or
+ *     without modification, are permitted provided that the following
+ *     conditions are met:
+ *
+ *      - Redistributions of source code must retain the above
+ *        copyright notice, this list of conditions and the following
+ *        disclaimer.
+ *
+ *      - Redistributions in binary form must reproduce the above
+ *        copyright notice, this list of conditions and the following
+ *        disclaimer in the documentation and/or other materials
+ *        provided with the distribution.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
+ * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
+ * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+ * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
+ * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
+ * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
+ * SOFTWARE.
+ *
+ * $Author: Christoph Lameter [cl@linux.com]$
+ *
+ */
+
+#define _GNU_SOURCE
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <stdbool.h>
+#include <stdarg.h>
+#include <unistd.h>
+#include <signal.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <syslog.h>
+#include <execinfo.h>
+#include "sched.h"
+#include "ring.h"
+#include "logging.h"
+
+int loglevel;
+bool background;
+
+
+__attribute__ ((format (printf, 2, 3)))
+void logg(int prio, const char *fmt, ...)
+{
+	va_list valist;
+
+	if ((prio & 0x7) > loglevel)
+		return;
+
+	va_start(valist, fmt);
+
+	if (current) {
+		int n;
+		char b[150];
+		b[0] = '0' + prio;
+
+		n = vsnprintf(b + 1, 149, fmt, valist);
+		ring_put(&current->ring, b, n);
+
+	} else if (background)
+		vsyslog(prio, fmt, valist);
+	else
+		vprintf(fmt, valist);
+}
+
+#define NR_FRAMES 100
+__attribute__ ((format (printf, 1, 2)))
+void panic(const char *fmt, ...)
+{
+	va_list valist;
+	void *frames[NR_FRAMES];
+	int nrframes;
+	int j;
+	char **strings;
+
+	printf("IB2ROCE Panic: ");
+	va_start(valist, fmt);
+	vprintf(fmt, valist);
+
+	nrframes = backtrace(frames, NR_FRAMES);
+	strings = backtrace_symbols(frames, nrframes);
+
+	for( j= 0; j < nrframes; j++) {
+		printf("%d. %s\n", j, strings[j]);
+	}
+	free(strings);
+	abort();
+}
+
Index: rdma-core/ib2roce/logging.h
===================================================================
--- /dev/null
+++ rdma-core/ib2roce/logging.h
@@ -0,0 +1,50 @@
+/*
+ * Logging interface
+ *
+ * (C) 2021-2022 Christoph Lameter <cl@linux.com>
+ *
+ * This software is available to you under a choice of one of two
+ * licenses.  You may choose to be licensed under the terms of the GNU
+ * General Public License (GPL) Version 2, available from the file
+ * COPYING in the main directory of this source tree, or the
+ * OpenIB.org BSD license below:
+ *
+ *     Redistribution and use in source and binary forms, with or
+ *     without modification, are permitted provided that the following
+ *     conditions are met:
+ *
+ *      - Redistributions of source code must retain the above
+ *        copyright notice, this list of conditions and the following
+ *        disclaimer.
+ *
+ *      - Redistributions in binary form must reproduce the above
+ *        copyright notice, this list of conditions and the following
+ *        disclaimer in the documentation and/or other materials
+ *        provided with the distribution.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
+ * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
+ * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+ * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
+ * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
+ * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
+ * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
+ * SOFTWARE.
+ *
+ * $Author: Christoph Lameter [cl@linux.com]$
+ *
+ */
+
+#define _GNU_SOURCE
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <stdarg.h>
+
+__attribute__ ((format (printf, 2, 3)))
+void logg(int prio, const char *fmt, ...);
+
+__attribute__ ((format (printf, 1, 2)))
+void panic(const char *fmt, ...);
+
+
